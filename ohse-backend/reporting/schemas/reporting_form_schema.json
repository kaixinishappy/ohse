{
  "$schema": "https://json-schema.org/draft-07/schema",
  "title": "Reporting Forms",
  "type": "object",
  "properties": {
    "incidents": {
      "type": "object",
      "required": [
        "business_unit", "site_name", "date_of_incident", "time_of_incident", "location",
        "description", "incident_type", "incident_category", "nature_of_injury",
        "injured_body_part", "injured_diagram"
      ],
      "properties": {
        "business_unit": { "type": "string", "minLength": 1 },
        "site_name": { "type": "string", "minLength": 1 },
        "date_of_incident": { "type": "string", "format": "date", "minLength": 1 },
        "time_of_incident": { "type": "string", "format": "time", "minLength": 1 },
        "location": { "type": "string", "minLength": 1 },
        "description": { "type": "string", "minLength": 1 },

        "incident_type": {
          "type": "string",
          "enum": ["Health & Safety", "Environment", "Equipment & Infrastructure", "Security", "Other"],
          "minLength": 1
        },
        "other_incident_type": { "type": "string", "minLength": 1 },

        "incident_category": {
          "type": "string",
          "enum": [
            "First aid", "Near Miss", "Dangerous Occurrence", "Environmental Incident", "Fatal",
            "Security Impact", "Occupational Illness", "Other",
            "Lost Time Injury (Bodily Injury – Schedule 1)",
            "Lost Time Injury (Other than Bodily Injury – Schedule 1)"
          ],
          "minLength": 1
        },
        "other_incident_category": { "type": "string", "minLength": 1 },

        "nature_of_injury": {
          "type": "string",
          "enum": [
            "Sprain/Strain", "Fracture", "Unconciousness", "Bruise", "Cut/Leceration",
            "Electric Shock", "Dislocation", "Other", "Burns", "Crushing", "Amputation"
          ],
          "minLength": 1
        },
        "other_nature_of_injury": { "type": "string", "minLength": 1 },

        "injured_body_part": {
          "type": "string",
          "enum": ["Head", "Face", "Neck", "Arm", "Foot", "Toe", "Eye", "Leg", "Hand", "Other", "Finger"],
          "minLength": 1
        },
        "other_injured_body_part": { "type": "string", "minLength": 1 },

        "injured_diagram": {
          "type": "object",
          "required": ["image_url", "marker_position"],
          "properties": {
            "image_url": { "type": "string", "format": "uri", "minLength": 1 },
            "marker_position": {
              "type": "object",
              "required": ["x", "y"],
              "properties": {
                "x": { "type": "number", "minimum": 0, "maximum": 1 }, 
                "y": { "type": "number", "minimum": 0, "maximum": 1 }
              }
            }
          }
        }
      },
      "allOf": [
        {
          "if": { "properties": { "incident_type": { "const": "Other" } } },
          "then": { "required": ["other_incident_type"] }
        },
        {
          "if": { "properties": { "incident_category": { "const": "Other" } } },
          "then": { "required": ["other_incident_category"] }
        },
        {
          "if": { "properties": { "nature_of_injury": { "const": "Other" } } },
          "then": { "required": ["other_nature_of_injury"] }
        },
        {
          "if": { "properties": { "injured_body_part": { "const": "Other" } } },
          "then": { "required": ["other_injured_body_part"] }
        }
      ]
    },

    "injuredPersons": {
      "type": "object",
      "required": [
        "name", "designation", "department", "age", "immediate_supervisor", "employment_type",
        "period_work_in_sunway", "employment_start_date", "engaged_in_performing_task_related_to_incident",
        "period_task_related_to_incident", "shift_schedule"
      ],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "designation": { "type": "string", "minLength": 1 },
        "department": { "type": "string", "minLength": 1 },
        "age": { "type": "integer", "minimum": 0 },
        "immediate_supervisor": { "type": "string", "minLength": 1 },

        "employment_type": {
          "type": "string",
          "enum": ["Sunway", "Client", "Contractor", "Other"],
          "minLength": 1
        },
        "employment_type_other": { "type": "string", "minLength": 1 },

        "period_work_in_sunway": {
          "type": "string",
          "enum": ["<6months", "<6months - 1 year", "1-3 years", ">3 years"],
          "minLength": 1
        },

        "employment_start_date": {
          "type": "string", "format": "date", "minLength": 1
        },

        "engaged_in_performing_task_related_to_incident": {
          "type": "string", "minLength": 1
        },

        "period_task_related_to_incident": {
          "type": "string",
          "enum": ["<6months", "<6months - 1 year", "1-3 years", ">3 years"],
          "minLength": 1
        },

        "shift_schedule": { "type": "boolean" },
        "shift_schedule_time": {
          "type": "string",
          "enum": ["day", "afternoon", "night"],
          "minLength": 1
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "employment_type": { "const": "Other" } },
            "required": ["employment_type"]
          },
          "then": { "required": ["employment_type_other"] }
        },
        {
          "if": {
            "properties": { "shift_schedule": { "const": true } },
            "required": ["shift_schedule"]
          },
          "then": { "required": ["shift_schedule_time"] }
        }
      ]
    },

    "medicalInfo": {
      "type": "object",
      "required": [
        "hospital", "med_cert_start_date", "med_cert_end_date", "med_cert_days",
        "ward_admitted_start_date", "ward_admitted_end_date", "ward_admitted_days"
      ],
      "properties": {
        "hospital": { "type": "string", "minLength": 1 },
        "med_cert_start_date": { "type": "string", "format": "date", "minLength": 1 },
        "med_cert_end_date": { "type": "string", "format": "date", "minLength": 1 },
        "med_cert_days": { "type": "integer", "minimum": 0 },
        "ward_admitted_start_date": { "type": "string", "format": "date", "minLength": 1 },
        "ward_admitted_end_date": { "type": "string", "format": "date", "minLength": 1 },
        "ward_admitted_days": { "type": "integer", "minimum": 0 },
        "disability": {
          "type": "string",
          "enum": ["Permanent Disability", "Non-Permanent Disability"],
          "minLength": 1
        }
      }
    },

    "witnessInfo": {
      "type": "object",
      "required": ["name", "designation", "witness_statement"],
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "designation": { "type": "string", "minLength": 1 },
        "witness_statement": { "type": "string", "minLength": 1 }
      }
    }
  },
  "required": ["incidents", "injuredPersons", "medicalInfo", "witnessInfo"]
}
